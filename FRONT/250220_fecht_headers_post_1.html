<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Javasript - Recoger datos de una APIc con POST</title>

    <!-- 
             Documentacion inicial: https://www.digitalocean.com/community/tutorials/how-to-use-the-javascript-fetch-api-to-get-data-es

             JAVASCRIPT
             - Conexion con API, con fecht y promesas
             - Creacion de nodos en el DOM




            EJEMPLO MODELO ENVIO DE POST
            - Recoje los datos por GET
            - Envia los datos fijos desde el script por POST (la insercion se pone de forma continua)

     -->
  </head>
  <body>
    <div class="contenedor">

<section>
    <h1>Peliculas</h1>
    <ul id="movies"></ul>
   </section>
    <button onclick="insertar()">Insertar</button>
  
    <section>
  
</section>
  </div>
    <script>
 // Recogida de nuevos elementos por GET

const url="http://localhost:8000/peliculas"


fetch(url)


.then((resp) => resp.json()) 


.then(function(data) {

    console.log(data)

  return data.map(function(valor) {

           //alert(valor.nombre);

           const listas=document.getElementById("movies");
           const lista=document.createElement("li");
                   let nombre=document.createTextNode(valor.nombre);
          lista.appendChild(nombre);
          listas.appendChild(lista);
  
  })

})
.catch(function(error) {
  console.log(error);
});

    </script>
    <script>
      // Insercion de un nuevo elemento por POST
    
    function insertar(){
            

const update = {
        id: 15,
        nombre: "Tiburon",
        director: "Steven Spielberg",
        clasificacion: "Aventura"
      }

const options = {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify(update),
};

let url2="http://localhost:8000/peliculas";

    
    fetch(url2, options)
    .then(response => response.json())
    .then(data => console.log(data))

    }
    
    </script>
  
  </body>
</html>
